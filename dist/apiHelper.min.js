!function(o,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):o.apiHelper=r()}(this,function(){"use strict";var o=function(o,r){var n={};return r.forEach(function(r){o[r]&&(n[r]=o[r])}),n},r=function(o){var r=o.json();return o.ok?r:r.then(Promise.reject.bind(Promise))},n=function(){var o;return(o=console).log.apply(o,arguments)},e=function(o){return 0===Object.keys(o)},i=function(o,i,t){return t&&n(i.method,o,e(i.body)?JSON.parse(i.body):""),fetch(o,i).then(r)},t=function(o){return o=o.toLowerCase(),"asc"===o||"desc"===o},a=function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=Object.keys(o).length;if(0===r)return"";var n="?",e=1;for(var i in o){var t=o[i];n+=i+"="+t,e<r&&(n+="&"),e++}return n},d={JSON:"json",FORMDATA:"formdata"},v=function(o){var r=new Headers;return r.append("Content-Type","application/json"),o&&("function"==typeof o&&(o=o()),r.append("Authorization","Bearer "+o)),r},u=function(o){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.conversion,e=void 0===n?d.JSON:n;if(e===d.JSON)return JSON.stringify(o);if(e===d.FORMDATA){var i=new FormData;for(var t in o)i.append(t,o[t]);return i}},c=function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=o.method,n=void 0===r?"GET":r,e=o.token,i=void 0===e?"":e,t=o.payload,a=void 0===t?{}:t,c=o.conversion,f=void 0===c?d.JSON:c,s=v(i),l={method:n,headers:s};return a&&(l.body=u(a,{conversion:f})),l},f=function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.url,e=r.fields,d=void 0===e?[]:e,v=r.token,u=void 0===v?"":v,f=r.log,s=void 0!==f&&f;return function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(r=o(r,d),r.sort&&!t(r.sort))throw new Error("sort should be 'asc' or 'desc'");var e=void 0;if(r.id||r._id){var v=r,f=v.id,l=v._id;e=n+"/"+(f||l)}else e=""+n+a(r);var h=c({token:u});return i(e,h,s)}},s=function(o){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.indicator,e=void 0===n?"?":n;return o.filter(function(o){return!o.startsWith(e)})},l=function(o,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},e=n.indicator,i=void 0===e?"?":e;return r=s(r,{indicator:i}),r.forEach(function(n){if(!o[n])throw new Error("payload must contain "+JSON.stringify(r))}),!0},h=function(o){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.indicator,e=void 0===n?"?":n;return o.map(function(o){return o.startsWith(e)?o.substring(1,o.length):o})},p=function(r){var n=r.url,e=r.fields,t=void 0===e?[]:e,a=r.token,v=void 0===a?"":a,u=r.log,f=void 0!==u&&u,s=r.conversion,p=void 0===s?d.JSON:s,g=r.indicator,y=void 0===g?"?":g;return function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(r=o(r,h(t,{indicator:y})),!l(r,t,{indicator:y}))throw new Error("payload must contain "+JSON.stringify(t));var e=c({method:"POST",token:v,payload:r,conversion:p});return i(n,e,f)}},g=function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=o.url,n=o.token,e=void 0===n?"":n,t=o.log,a=void 0!==t&&t;return function(o){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=n.hard,d=void 0!==t&&t;if(!o)throw new Error("please provide an id");var v=r+"/"+o,u=d?{hard:!0}:{},f=c({method:"DELETE",token:e,payload:u});return i(v,f,a)}},y=function(o,r,n){var e=n.indicator;return r=h(r,{indicator:e}),Object.keys(o).length===Object.keys(r).length&&(r.forEach(function(r){if(!o[r])return!1}),!0)},k=function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.url,e=r.fields,t=void 0===e?[]:e,a=r.token,v=void 0===a?"":a,u=r.log,f=void 0!==u&&u,s=r.conversion,l=void 0===s?d.JSON:s,p=r.indicator,g=void 0===p?"?":p;return function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=r,a=e.id,d=e._id;if(!a&&!d)throw new Error("please provide an id or _id field");r=o(r,h(t,{indicator:g}));var u=y(r,t,{indicator:g})?"PUT":"PATCH",s=c({method:u,token:v,payload:r,conversion:l});return i(n,s,f)}},b=function(o){return"object"==typeof o&&!Array.isArray(o)&&null!==o},w=function(o){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.indicator,e=void 0===n?"?":n,i=[],t=[],a=["per_page","page"],d=["id","_id"],v=["sort","sort_by"];if(Array.isArray(o))i=o,t=o;else{if(!b(o))throw new Error("fields must be an Object or an array");i=o.query||[],t=o.payload||[]}return{query:h(i,{indicator:e}),payload:t,_page:a,_id:d,_sort:v}},O=function(o){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.token,e=r.base,i=r.log,t=void 0!==i&&i,a=r.fields,v=r.conversion,u=void 0===v?d.JSON:v,c=r.indicator,s=void 0===c?"?":c;if(!e)throw new Error("please set a base path (absolute URL)");if(!o)throw new Error("please provide a route (cfr. users, feedback,...)");a=w(a);var l=e+"/"+o;return{get:f({url:l,fields:[].concat(a.query,a._page,a._id,a._sort),token:n,log:t}),insert:p({url:l,fields:a.payload,token:n,log:t,conversion:u,indicator:s}),remove:g({url:l,token:n,log:t}),update:k({url:l,fields:a.payload,token:n,log:t,conversion:u,indicator:s})}};return O});
